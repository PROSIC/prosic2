name: prosic
author: Johannes KÃ¶ster <johannes.koester@tu-dortmund.de>, Louis Dijkstra
about: "A caller for somatic indels in tumor-normal pairs."

settings:
    - SubcommandRequired

global_settings:
    - ColoredHelp

args:
  - verbose:
      short: v
      help: Provide verbose output.

subcommands:
  - call-tumor-normal:
      about: Call somatic and germline variants from a tumor-normal sample pair and a VCF/BCF with candidate variants.
      args:
        - tumor:
            required: true
            help: BAM file with reads from tumor sample.
        - normal:
            required: true
            help: BAM file with reads from normal sample.
        - reference:
            required: true
            help: FASTA file with reference genome. Has to be indexed with samtools faidx.
        - candidates:
            long: candidates
            short: c
            value_name: FILE
            help: VCF/BCF file to process (if omitted, read from STDIN).
        - output:
            long: output
            short: o
            value_name: FILE
            help: BCF file that shall contain the results (if omitted, write to STDOUT).
        - tumor-stats:
            long: tumor-stats
            value_name: FILE
            requires: normal-stats
            conflicts_with:
              - insert-size-mean
              - insert-size-sd
              - normal-insert-size-mean
              - normal-insert-size-sd
            help: |
              Output of `samtools stats` for tumor bam. Either provide this or
              use --isize-mean and --isize-sd.
        - normal-stats:
            long: normal-stats
            value_name: FILE
            requires: tumor-stats
            conflicts_with:
              - insert-size-mean
              - insert-size-sd
              - normal-insert-size-mean
              - normal-insert-size-sd
            help: |
              Output of `samtools stats` for normal bam. Either provide this or
              use --normal-isize-mean and --normal-isize-sd.
        - insert-size-mean:
            long: isize-mean
            short: m
            value_name: FLOAT
            requires:
              - insert-size-sd
            help: Mean of sample insert size.
        - insert-size-sd:
            long: isize-sd
            short: s
            value_name: FLOAT
            requires:
              - insert-size-mean
            help: Standard deviation of sample insert size.
        - normal-insert-size-mean:
            long: normal-isize-mean
            value_name: FLOAT
            requires:
              - normal-insert-size-sd
              - insert-size-mean
              - insert-size-sd
            help: Mean of normal sample insert size (if it differs from tumor).
        - normal-insert-size-sd:
            long: normal-isize-sd
            value_name: FLOAT
            requires:
              - normal-insert-size-mean
              - insert-size-mean
              - insert-size-sd
            help: Standard deviation of normal sample insert size (if it differs from tumor).
        - effective-mutation-rate:
            long: effmut
            value_name: FLOAT
            default_value: "2000.0"
            help: Effective SNV mutation rate of tumor sample (should be estimated from somatic SNVs).
        - deletion-factor:
            long: deletion-factor
            short: d
            value_name: FLOAT
            default_value: "0.03"
            help: Factor of deletion mutation rate relative to SNV mutation rate (0.03 according to Hodkinson et al. Nature Reviews Genetics 2011).
        - insertion-factor:
            long: insertion-factor
            short: i
            value_name: FLOAT
            default_value: "0.01"
            help: Factor of insertion mutation rate relative to SNV mutation rate (0.01 according to Hodkinson et al. Nature Reviews Genetics 2011).
        - ploidy:
            long: ploidy
            short: p
            value_name: INT
            default_value: "2"
            help: Average ploidy of tumor and normal sample.
        - purity:
            long: purity
            short: a
            value_name: FLOAT
            default_value: "1.0"
            help: Purity of tumor sample.
        - heterozygosity:
            long: het
            value_name: FLOAT
            default_value: "1.25E-4"
            help: Expected heterozygosity of normal sample.
        - adjust-mapq:
            long: adjust-mapq
            help: Downgrade mapping quality of alignments supporting an indel if there are no fragments supporting the same indel. Such cases are more likely to be alignment/repeat artifacts.
        - prob-spurious-isize:
            long: spurious-isize-rate
            short: r
            value_name: FLOAT
            default_value: "0.0"
            help: "Rate of wrongly reported insert size abberations (should be set depending on mapper, BWA: 0.01332338, LASER: 0.05922201)."
        - prob-spurious-ins:
            long: spurious-ins-rate
            value_name: FLOAT
            default_value: "2.8e-6"
            help: "Rate of spuriously inserted bases by the sequencer (Illumina: 2.8e-6, see Schirmer et al. BMC Bioinformatics 2016)."
        - prob-spurious-del:
            long: spurious-del-rate
            value_name: FLOAT
            default_value: "5.1e-6"
            help: "Rate of spuriosly deleted bases by the sequencer (Illumina: 5.1e-6, see Schirmer et al. BMC Bioinformatics 2016)."
        - prob-ins-extend:
            long: spurious-insext-rate
            value_name: FLOAT
            default_value: "0.0"
            help: "Extension rate of spurious insertions by the sequencer (Illumina: 0.0, see Schirmer et al. BMC Bioinformatics 2016) [0.0]."
        - prob-del-extend:
            long: spurious-delext-rate
            value_name: FLOAT
            default_value: "0.0"
            help: "Extension rate of spurious insertions by the sequencer (Illumina: 0.0, see Schirmer et al. BMC Bioinformatics 2016)."
        - pileup-window:
            long: pileup-window
            value_name: INT
            default_value: "2500"
            help: Window to investigate for evidence left and right of each variant.
        - omit-snvs:
            long: omit-snvs
            help: Don't call SNVs.
        - omit-indels:
            long: omit-indels
            help: Don't call indels.
        - omit-fragment-evidence:
            long: omit-fragment-evidence
            help: Omit evidence consisting of read pairs with unexpected insert size (insert size parameters will be ignored).
        - omit-secondary-alignments:
            long: omit-secondary-alignments
            help: Omit secondary alignments.
        - omit-mapq:
            long: omit-mapq
            help: Omit mapping quality (all alignments are trusted).
        - observations:
            long: obs
            value_name: FILE
            help: Optional path where read observations shall be written to. The resulting file contains a line for each observation with tab-separated values.
        - flat-priors:
            long: flat-priors
            help: Ignore the prior model and use flat priors instead.
        - max-indel-len:
            long: max-indel-len
            value_name: INT
            default_value: "1000"
            help: Omit longer indels when calling.
        - exclusive-end:
            long: exclusive-end
            help: Assume that the END tag is exclusive (i.e. it points to the position after the variant). This is needed, e.g., for DELLY.
        - indel-window:
            long: indel-window
            value_name: INT
            default_value: "100"
            help: Number of bases to consider left and right of indel breakpoint when calculating read support. This number should not be too large in order to avoid biases caused by other close variants.

  - estimate-mutation-rate:
      about: Estimate the effective mutation rate of a tumor sample from a VCF/BCF with candidate variants from STDIN.
      args:
        - min-af:
            long: min-af
            short: f
            value_name: FLOAT
            help: Minimum allele frequency to consider [0.12].
        - max-af:
            long: max-af
            short: F
            value_name: FLOAT
            help: Maximum allele frequency to consider [0.25].
        - fit:
            long: fit
            value_name: FILE
            help: Path to file that will observations and the parameters of the fitted model as JSON.

  - control-fdr:
      about: Print thresholds for controlling the FDR at different levels using Benjamini-Hochberg over p-values generated from an empirical null distribution of posterior error probabilities.
      args:
        - calls:
            required: true
            help: Calls as provided by prosic tumor-normal.
        - method:
            required: true
            long: method
            value_name: STRING
            possible_values:
              - bh
              - ev
            help: |
              Method to use. If bh, use Benjamini-Hochberg over p-values generated from an empirical null distribution of posterior error probabilities (--null-calls is required in this case).
              If ev, calculate the expected FDR over posterior error probabilities as presented by Mueller et al. 2006.
        - null-calls:
            value_name: FILE
            long: null-calls
            help: Null model calls as provided by prosic tumor-normal, e.g. when flipping tumor and normal sample.
        - event:
            long: event
            short: e
            value_name: STRING
            help: Event to consider.
        - vartype:
            long: var
            value_name: STRING
            required: true
            help: Variant type to consider (SNV, INS, DEL).
        - min-len:
            long: min-len
            value_name: INT
            help: Minimum indel length to consider.
        - max-len:
            long: max-len
            value_name: INT
            help: Maximum indel length to consider (exclusive).
